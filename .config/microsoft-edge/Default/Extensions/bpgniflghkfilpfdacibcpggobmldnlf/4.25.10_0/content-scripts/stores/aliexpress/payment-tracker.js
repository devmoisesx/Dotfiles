(()=>{"use strict";var e={83043:(e,t,r)=>{r.d(t,{Ay:()=>_});class n{async getStoreBySlug(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreBySlug",data:{slug:e}},(e=>{t(e)}))}))}async getHostsBySlug(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getHostsBySlug",data:{slug:e}},(e=>{t(e)}))}))}async getStoreByName(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreByName",data:{name:e}},(e=>{t(e)}))}))}async getAllSlugs(){return new Promise((e=>{chrome.runtime.sendMessage({action:"getAllSlugs"},(t=>{e(t)}))}))}async getStoreByUrl(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreByUrl",data:{url:e}},(e=>{t(e)}))}))}}const c=new(y("StoreHelper"));class _{constructor(e){this.initPaymentTracker(e)}async initPaymentTracker(e){try{this.store||(this.store=await this.getStoreInfo(e));const{paymentTracker:t}=this.store.extensionConfiguration??{};this.paymentSelectors=t,this.defineSelector(),await this.handleCurrentPayment(),this.observerPaymentMethod()}catch(e){this.handleError(e)}}defineSelector(){this.shouldUseBackupSelector()?this.setSelector("backupSelector"):this.setSelector("selector")}async getStoreInfo(e){const t=await y("storeHelper").getStoreBySlug(e);return this.storeSlug=e,t}setSelector(e){this.currentSelector=e,"backupSelector"==e?(this.currentMatcher="parentElement",this.selector=this.paymentSelectors.backupSelector):(this.currentMatcher=this.paymentSelectors.matcher,this.selector=this.paymentSelectors.selector)}shouldUseBackupSelector(){const e=this.paymentSelectors.limitOfNodes,t=document.querySelectorAll(this.paymentSelectors.selector);return 0==t.length||t.length>e}observerPaymentMethod(){setInterval((()=>{(this.shouldUseBackupSelector()&&"selector"==this.currentSelector||!this.shouldUseBackupSelector()&&"backupSelector"==this.currentSelector)&&(r.disconnect(),this.initPaymentTracker(this.storeSlug))}),1e4);const e=document.querySelector(this.selector),t=this,r=new MutationObserver((async function(e,r){t.handleCurrentPayment()}));r.observe(e,{subtree:!0,childList:!0,characterDataOldValue:!0})}async handleCurrentPayment(){try{const e=await this.getCurrentPayment();this.saveOnSession(e)}catch(e){this.handleError(e)}}saveOnSession(e){chrome.runtime.sendMessage({action:"addStoreToPaymentTracker",data:{type:e,slug:this.storeSlug}})}getCurrentPayment(){return new Promise((e=>{const t=document.querySelector(this.selector);t||e("other"),this.currentPayment=this.getPaymentInfo(t),this.paymentTypes=this.paymentSelectors.types;this.isPaymentTypeSupported("pix")&&e("pix");this.isPaymentTypeSupported("credit_card")&&e("credit_card");this.isPaymentTypeSupported("ticket")&&e("ticket");this.isPaymentTypeSupported("paypal")&&e("paypal");this.isPaymentTypeSupported("payment_in_installments")&&e("payment_in_installments"),e("other")}))}getPaymentInfo(e){return this.matcher(this.currentMatcher,e)}isPaymentTypeSupported(e){return!!this.paymentTypes[e]&&this.currentPayment.includes(this.paymentTypes[e])}matcher(e,t){return{innerText:e=>e.innerText,parentElement:e=>{const t=e.querySelector(".comet-radio-checked");if(!t)return"other";return t.parentElement.querySelector("[data-pl='payment-method-title']").innerText}}[e](t)}handleError(e){const t={action:"error",error:e.message?e.message:e,store:this.storeSlug};chrome.runtime.sendMessage({action:"lookerSendEvent",data:{evt:"TYPE_OF_PAYMENT",...t}})}}function o(){try{if(r.g)return r.g}catch(e){try{if(window)return window}catch(e){return this}}}var s=null;function i(){if(null===s){let e=o();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),s=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return s}function a(){let e=o();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function u(){let e=i(),t=a(),r=t[e];return r||(t[e]=Object.create(null),r=t[e]),r}!function(){let e=o();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var l="__INTENTIONAL_UNDEFINED__";let h={};function y(e){let t=u();if(void 0===t[e])return function(e){switch(e){case"StoreHelper":return n;case"storeHelper":return c}return}(e);var r=t[e];return r===l?void 0:r}function f(e,t){let r=u();return"object"==typeof e?(Object.keys(e).forEach((function(t){r[t]=e[t]})),function(){Object.keys(e).forEach((function(t){p(e)}))}):(r[e]=void 0===t?l:t,function(){p(e)})}function p(e){let t=u();delete t[e],0==Object.keys(t).length&&delete a()[i]}function d(e){let t=u();var r=Object.keys(e),n={};function c(){r.forEach((function(e){t[e]=n[e]}))}return function(_){r.forEach((function(r){n[r]=t[r],t[r]=e[r]}));let o=_();return o&&"function"==typeof o.then?o.then(c).catch(c):c(),o}}!function(){function e(e,t){Object.defineProperty(h,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",y),e("__GetDependency__",y),e("__Rewire__",f),e("__set__",f),e("__reset__",p),e("__ResetDependency__",p),e("__with__",d)}();let m=typeof _;function E(e,t){Object.defineProperty(_,e,{value:t,enumerable:!1,configurable:!0})}"object"!==m&&"function"!==m||!Object.isExtensible(_)||(E("__get__",y),E("__GetDependency__",y),E("__Rewire__",f),E("__set__",f),E("__reset__",p),E("__ResetDependency__",p),E("__with__",d),E("__RewireAPI__",h))}},t={};function r(n){var c=t[n];if(void 0!==c)return c.exports;var _=t[n]={exports:{}};return e[n](_,_.exports,r),_.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=r(83043);class t extends(l("PaymentTracker")){constructor(e){super(e)}}const n="aliexpress";function c(){try{if(r.g)return r.g}catch(e){try{if(window)return window}catch(e){return this}}}new(l("AliexpressPaymentTracker"))(l("storeSlug"));var _=null;function o(){if(null===_){let e=c();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),_=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return _}function s(){let e=c();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function i(){let e=o(),t=s(),r=t[e];return r||(t[e]=Object.create(null),r=t[e]),r}!function(){let e=c();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var a="__INTENTIONAL_UNDEFINED__";let u={};function l(r){let c=i();if(void 0===c[r])return function(r){switch(r){case"PaymentTracker":return e.Ay;case"AliexpressPaymentTracker":return t;case"storeSlug":return n}return}(r);var _=c[r];return _===a?void 0:_}function h(e,t){let r=i();return"object"==typeof e?(Object.keys(e).forEach((function(t){r[t]=e[t]})),function(){Object.keys(e).forEach((function(t){y(e)}))}):(r[e]=void 0===t?a:t,function(){y(e)})}function y(e){let t=i();delete t[e],0==Object.keys(t).length&&delete s()[o]}function f(e){let t=i();var r=Object.keys(e),n={};function c(){r.forEach((function(e){t[e]=n[e]}))}return function(_){r.forEach((function(r){n[r]=t[r],t[r]=e[r]}));let o=_();return o&&"function"==typeof o.then?o.then(c).catch(c):c(),o}}!function(){function e(e,t){Object.defineProperty(u,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",l),e("__GetDependency__",l),e("__Rewire__",h),e("__set__",h),e("__reset__",y),e("__ResetDependency__",y),e("__with__",f)}();let p=typeof t;function d(e,r){Object.defineProperty(t,e,{value:r,enumerable:!1,configurable:!0})}"object"!==p&&"function"!==p||!Object.isExtensible(t)||(d("__get__",l),d("__GetDependency__",l),d("__Rewire__",h),d("__set__",h),d("__reset__",y),d("__ResetDependency__",y),d("__with__",f),d("__RewireAPI__",u))})()})();