(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();class t{async getStoreBySlug(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreBySlug",data:{slug:e}},(e=>{t(e)}))}))}async getHostsBySlug(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getHostsBySlug",data:{slug:e}},(e=>{t(e)}))}))}async getStoreByName(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreByName",data:{name:e}},(e=>{t(e)}))}))}async getAllSlugs(){return new Promise((e=>{chrome.runtime.sendMessage({action:"getAllSlugs"},(t=>{e(t)}))}))}async getStoreByUrl(e){return new Promise((t=>{chrome.runtime.sendMessage({action:"getStoreByUrl",data:{url:e}},(e=>{t(e)}))}))}}const r=new(_("StoreHelper"));class n{constructor(e){this.initPaymentTracker(e)}async initPaymentTracker(e){try{this.store||(this.store=await this.getStoreInfo(e));const{paymentTracker:t}=this.store.extensionConfiguration??{};this.paymentSelectors=t,this.defineSelector(),await this.handleCurrentPayment(),this.observerPaymentMethod()}catch(e){this.handleError(e)}}defineSelector(){this.shouldUseBackupSelector()?this.setSelector("backupSelector"):this.setSelector("selector")}async getStoreInfo(e){const t=await _("storeHelper").getStoreBySlug(e);return this.storeSlug=e,t}setSelector(e){this.currentSelector=e,"backupSelector"==e?(this.currentMatcher="parentElement",this.selector=this.paymentSelectors.backupSelector):(this.currentMatcher=this.paymentSelectors.matcher,this.selector=this.paymentSelectors.selector)}shouldUseBackupSelector(){const e=this.paymentSelectors.limitOfNodes,t=document.querySelectorAll(this.paymentSelectors.selector);return 0==t.length||t.length>e}observerPaymentMethod(){setInterval((()=>{(this.shouldUseBackupSelector()&&"selector"==this.currentSelector||!this.shouldUseBackupSelector()&&"backupSelector"==this.currentSelector)&&(r.disconnect(),this.initPaymentTracker(this.storeSlug))}),1e4);const e=document.querySelector(this.selector),t=this,r=new MutationObserver((async function(e,r){t.handleCurrentPayment()}));r.observe(e,{subtree:!0,childList:!0,characterDataOldValue:!0})}async handleCurrentPayment(){try{const e=await this.getCurrentPayment();this.saveOnSession(e)}catch(e){this.handleError(e)}}saveOnSession(e){chrome.runtime.sendMessage({action:"addStoreToPaymentTracker",data:{type:e,slug:this.storeSlug}})}getCurrentPayment(){return new Promise((e=>{const t=document.querySelector(this.selector);t||e("other"),this.currentPayment=this.getPaymentInfo(t),this.paymentTypes=this.paymentSelectors.types;this.isPaymentTypeSupported("pix")&&e("pix");this.isPaymentTypeSupported("credit_card")&&e("credit_card");this.isPaymentTypeSupported("ticket")&&e("ticket");this.isPaymentTypeSupported("paypal")&&e("paypal");this.isPaymentTypeSupported("payment_in_installments")&&e("payment_in_installments"),e("other")}))}getPaymentInfo(e){return this.matcher(this.currentMatcher,e)}isPaymentTypeSupported(e){return!!this.paymentTypes[e]&&this.currentPayment.includes(this.paymentTypes[e])}matcher(e,t){return{innerText:e=>e.innerText,parentElement:e=>{const t=e.querySelector(".comet-radio-checked");if(!t)return"other";return t.parentElement.querySelector("[data-pl='payment-method-title']").innerText}}[e](t)}handleError(e){const t={action:"error",error:e.message?e.message:e,store:this.storeSlug};chrome.runtime.sendMessage({action:"lookerSendEvent",data:{evt:"TYPE_OF_PAYMENT",...t}})}}function s(){try{if(e.g)return e.g}catch(e){try{if(window)return window}catch(e){return this}}}var o=null;function c(){if(null===o){let e=s();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),o=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return o}function i(){let e=s();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function a(){let e=c(),t=i(),r=t[e];return r||(t[e]=Object.create(null),r=t[e]),r}!function(){let e=s();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var u="__INTENTIONAL_UNDEFINED__";let l={};function _(e){let n=a();if(void 0===n[e])return function(e){switch(e){case"StoreHelper":return t;case"storeHelper":return r}return}(e);var s=n[e];return s===u?void 0:s}function h(e,t){let r=a();return"object"==typeof e?(Object.keys(e).forEach((function(t){r[t]=e[t]})),function(){Object.keys(e).forEach((function(t){y(e)}))}):(r[e]=void 0===t?u:t,function(){y(e)})}function y(e){let t=a();delete t[e],0==Object.keys(t).length&&delete i()[c]}function m(e){let t=a();var r=Object.keys(e),n={};function s(){r.forEach((function(e){t[e]=n[e]}))}return function(o){r.forEach((function(r){n[r]=t[r],t[r]=e[r]}));let c=o();return c&&"function"==typeof c.then?c.then(s).catch(s):s(),c}}!function(){function e(e,t){Object.defineProperty(l,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",_),e("__GetDependency__",_),e("__Rewire__",h),e("__set__",h),e("__reset__",y),e("__ResetDependency__",y),e("__with__",m)}();let p=typeof n;function d(e,t){Object.defineProperty(n,e,{value:t,enumerable:!1,configurable:!0})}"object"!==p&&"function"!==p||!Object.isExtensible(n)||(d("__get__",_),d("__GetDependency__",_),d("__Rewire__",h),d("__set__",h),d("__reset__",y),d("__ResetDependency__",y),d("__with__",m),d("__RewireAPI__",l))})();