(()=>{"use strict";var e={53012:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCacheExpired=void 0;t.isCacheExpired=(e=0)=>new Date>new Date(e)},38871:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionStorage=void 0;const o=r(n(3141)),s=n(53012),i=n(22452);t.ExtensionStorage=class{constructor(e){this.get=async e=>{var t;return null!==(t=(await chrome.storage[this.cacheType].get(e))[e])&&void 0!==t?t:null},this.getValid=async e=>{const t=await this.get(e);return t&&!(0,s.isCacheExpired)(t.timeToExpire)?t:null},this.set=async({key:e,value:t,timeToExpire:n,eTag:r})=>{const o={};o[e]={value:t,timeToExpire:n},r&&(o[e].eTag=r),await chrome.storage[this.cacheType].set(o)},this.delete=async e=>{await chrome.storage[this.cacheType].remove(e)},this.handleRequestUsingCache=async({uniqueKey:e,requestUrl:t,expirationInMilliseconds:n,options:r,retry:a})=>{const c=await this.get(e);if(c&&!(0,s.isCacheExpired)(c.timeToExpire))return c.value;const l=(new Date).getTime()+(n||3e5);let _={"Cache-Control":"no-cache"};(null==c?void 0:c.eTag)&&(_["If-None-Match"]=c.eTag),r&&(_={..._,...r});return await o.default.request({uniqueKey:e,requestUrl:t,options:{method:"get",headers:_}}).then((t=>this.handleResponse(e,t,c,l))).catch((async()=>!a||a.attempts<=0?{}:(await i.TimerHelper.waitDelay(a.delayInMs),this.handleRequestUsingCache({uniqueKey:e,requestUrl:t,expirationInMilliseconds:n,options:r,retry:{attempts:a.attempts-1,delayInMs:2*a.delayInMs}}))))},this.handleResponse=async(e,t,n,r)=>{var o,s,i;const a=!t||t instanceof Error,c=(null==t?void 0:t.status)>=400||(null==t?void 0:t.status)<200;if(a||c)throw new Error(`Server error: ${null!==(o=null==t?void 0:t.status)&&void 0!==o?o:500}`);const l=null!==(s=t.headers.get("ETag"))&&void 0!==s?s:void 0;if(!(!l||!(null==n?void 0:n.eTag)||l!==n.eTag))return this.set({key:e,value:null!==(i=n.value)&&void 0!==i?i:n,timeToExpire:r,eTag:l}),n.value;const _=await t.clone().json();return this.set({key:e,value:_,timeToExpire:r,eTag:l}),_},this.cacheType=e}}},22452:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimerHelper=void 0;class n{}t.TimerHelper=n,n.waitDelay=async e=>{await new Promise((t=>setTimeout((()=>t(null)),e)))}},18731:(e,t,n)=>{t.wS=void 0;const r=n(38871);t.wS=new r.ExtensionStorage("local"),new r.ExtensionStorage("session")},3141:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{constructor(){this.cache={}}request({uniqueKey:e,requestUrl:t,options:n}){return e?(e in this.cache||(this.cache[e]=fetch(t,n).then((e=>{if(e.status<200||e.status>399)throw{message:`Response status error: ${e.status}`,status:e.status};return e})).catch((e=>e)).finally((()=>{delete this.cache[e]}))),this.cache[e]):Promise.reject(new Error("Unique key not passed"))}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{let e=[],t={observe(e,t,n){let r=new(m("Observer"))(e,t,n);return m("observers").push(r),r}};const r=t;class o{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.observedSelector=e,this.previousElements=[],this.onChange=t,this.options={observeCreation:!0,observeDeletion:!1,changedOnly:!1,...n}}}let s=new MutationObserver((function(e){for(let t of m("observers")){let n=document.querySelectorAll(t.observedSelector);m("checkForChanges")(e,n,t),m("checkForCreation")(n,t),m("checkForDeletion")(n,t),t.previousElements=n}}));function i(e,t,n){for(let r of t){let o=e.filter((e=>e.target===r));o.length&&n.onChange(n.options.changedOnly?o.map((e=>e.target)):Array.prototype.slice.call(t),n)}}function a(e,t){t.options.observeCreation&&e.length&&!t.previousElements.length&&t.onChange(Array.prototype.slice.call(e),t)}function c(e,t){t.options.observeDeletion&&!e.length&&t.previousElements.length&&t.onChange(null,t)}function l(){try{if(n.g)return n.g}catch(e){try{if(window)return window}catch(e){return this}}}m("globalObserver").observe(document.querySelector("body"),{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0});var _=null;function u(){if(null===_){let e=l();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),_=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return _}function h(){let e=l();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function d(){let e=u(),t=h(),n=t[e];return n||(t[e]=Object.create(null),n=t[e]),n}!function(){let e=l();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var g="__INTENTIONAL_UNDEFINED__";let f={};function m(t){let n=d();if(void 0===n[t])return function(t){switch(t){case"observers":return e;case"checkForChanges":return i;case"checkForCreation":return a;case"checkForDeletion":return c;case"globalObserver":return s;case"Observer":return o}return}(t);var r=n[t];return r===g?void 0:r}function y(e,t){let n=d();return"object"==typeof e?(Object.keys(e).forEach((function(t){n[t]=e[t]})),function(){Object.keys(e).forEach((function(t){v(e)}))}):(n[e]=void 0===t?g:t,function(){v(e)})}function v(e){let t=d();delete t[e],0==Object.keys(t).length&&delete h()[u]}function E(e){let t=d();var n=Object.keys(e),r={};function o(){n.forEach((function(e){t[e]=r[e]}))}return function(s){n.forEach((function(n){r[n]=t[n],t[n]=e[n]}));let i=s();return i&&"function"==typeof i.then?i.then(o).catch(o):o(),i}}!function(){function e(e,t){Object.defineProperty(f,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",m),e("__GetDependency__",m),e("__Rewire__",y),e("__set__",y),e("__reset__",v),e("__ResetDependency__",v),e("__with__",E)}();function p(e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,configurable:!0})}Object.isExtensible(t)&&(p("__get__",m),p("__GetDependency__",m),p("__Rewire__",y),p("__set__",y),p("__reset__",v),p("__ResetDependency__",v),p("__with__",E),p("__RewireAPI__",f));var b=n(18731);let O={add:function(e,t,n){var r={};r[e]=t,chrome.storage.local.set(r,(function(){chrome.runtime.lastError&&console.log("error on retrieving from local storage");const t={status:!0,data:r[e],message:`O item ${e} foi adicionado.`};n&&n(t)}))},get:function(e,t){chrome.storage.local.get(e,(function(e){chrome.runtime.lastError&&console.log("error on retrieving from local storage");const n=Object.keys(e).length>0?{exist:!0,data:e}:{exist:!1,data:null};t&&t(n)}))},getAsync:function(e){return new Promise((t=>{chrome.storage.local.get(e,(n=>{t(n[e]??null)}))}))},addSync:function(e,t,n){var r={};r[e]=t,chrome.storage.sync.set(r,(function(){chrome.runtime.lastError&&console.log("error on retrieving from sync storage");const t={status:!0,data:r[e],message:`O item ${e} foi adicionado.`};n&&n(t)}))},getSync:function(e,t){chrome.storage.sync.get(e,(function(e){chrome.runtime.lastError&&console.log("error on retrieving from sync storage");const n=Object.keys(e).length>0?{exist:!0,data:e}:{exist:!1,data:null};t&&t(n)}))},getAll:function(){return new Promise((e=>{chrome.storage.local.get(null,(function(t){var n=Object.keys(t);e(n)}))}))},remove:function(e,t){chrome.storage.local.remove(e,(function(){chrome.runtime.lastError&&console.log("error on retrieving from local storage");t&&t({status:!0,message:`O item ${e} foi removido.`})}))},removeAsync:function(e){return new Promise((t=>{chrome.storage.local.remove(e,(()=>{t(null)}))}))},addCache(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return new Promise(((r,o)=>{if(!e||!n)return o(new Error("key or expire time not undefined"));var s={value:t,expiresAt:(new Date).getTime()+n};this.add(e.toString(),s,(e=>r(e)))}))},addCacheEtag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise(((o,s)=>{if(!e||!n)return s(new Error("key or expire time not undefined"));var i={value:t,etag:r,caches_until:(new Date).getTime()+n};this.add(e.toString(),i,(e=>o(e)))}))},async getCacheEtag(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{config:o}=await chrome.storage.local.get("config"),{requestCacheLibRetry:s}=(null==o?void 0:o.value)||{};let i=null;return s&&s.enabled&&(i={attempts:s.attempts??0,delayInMs:s.delayInMs??0}),$("extensionLocalStorage").handleRequestUsingCache({uniqueKey:e,requestUrl:t,expirationInMilliseconds:n,options:r,retry:i})},getValid:e=>$("extensionLocalStorage").getValid(e),set:(e,t,n,r)=>$("extensionLocalStorage").set({key:e,value:t,timeToExpire:n,eTag:r}),setSetting(e,t){return new Promise((n=>{this.get("settings",(r=>{var o;let s=(null===(o=r.data)||void 0===o?void 0:o.settings)||{};s[e]=t,this.add("settings",s,(()=>n()))}))}))},getSetting(e){return new Promise((t=>{this.get("settings",(n=>{if(!n.exist)return t(null);t(n.data.settings[e]??null)}))}))},getCache(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((n=>{chrome.storage.local.get(e.toString(),(r=>{if(Object.keys(r).length>0){let o=r[e];if((null==o?void 0:o.expiresAt)>(new Date).getTime())return n(o.value??o);if(!t)return n();this.remove(e)}n(null)}))}))},updateCache(e,t){return new Promise((n=>{chrome.storage.local.get(e.toString(),(r=>{if(Object.keys(r).length>0){let o=r[e],s={value:t,expiresAt:o.expiresAt};this.add(e.toString(),s,(e=>n(e)))}}))}))},getSession:async e=>chrome.storage.session.get(e).then((t=>t[e])),addSession(e,t,n){const r={};r[e]=n?{value:t,expiresAt:(new Date).getTime()+n}:t,chrome.storage.session.set(r)},removeSession(e){chrome.storage.session.remove(e)},async addStoreToPaymentTracker(e,t){let n=await this.getSession("payment_tracker"),r={};n&&Object.keys(t).length&&(r=n),r[t]||(r[t]=""),r[t].includes(e)||(r[t]=e),this.addSession("payment_tracker",r)},async getStorePaymentType(e){return new Promise((t=>{this.getSession("payment_tracker").then((n=>t(null==n?void 0:n[e])))}))},async removeStorePaymentType(e){let t=await this.getSession("payment_tracker");t[e]&&delete t[e],this.addSession("payment_tracker",t)},async addStoreToRememberList(e,t){let n=await this.getSession("remember"),r={};n&&Object.keys(n).length&&(r=n),r[e]||(r[e]=[]),r[e].includes(t)||r[e].push(t),this.addSession("remember",r)},storeExistOnRememberList(e,t){return new Promise((n=>{this.storesFromRememberList(e,(async e=>{n(e&&e.includes(t))}))}))},removeStoreFromRememberList(e,t){this.storesFromRememberList(e,(async n=>{if(!n)return;n.splice(n.indexOf(t),1);let r=await this.getSession("remember"),o={};r&&Object.keys(r).length&&(o=r),o[e]=n,this.addSession("remember",o)}))},async storesFromRememberList(e,t){let n=await this.getSession("remember");return t(null==n?void 0:n[e])},async removeKeySession(e,t){let n=await this.getSession("remember");n[e].includes(t)&&delete n[e],this.addSession("remember",n)},async isSessionKeyValid(e){let t=await this.getSession(e);return t&&t.expiresAt>(new Date).getTime()},getAllAndFilterByKey:async e=>new Promise((t=>{chrome.storage.local.get(null,(n=>{const r=Object.entries(n).filter((t=>{let[n,r]=t;return n.startsWith(e)&&r.value.hasVisited})).map((e=>{let[,t]=e;return{...t.value}}));t(r)}))})),getLocalStorage:async()=>new Promise((e=>{chrome.storage.local.get(null,(t=>{e(t)}))})),async removeStoreCaches(e){const t=await this.getLocalStorage(),n=Object.keys(t).reduce(((t,n)=>(e.find((e=>n===`cache_${e}`||n===`cache_${e}_core`))&&t.push(n),t)),[]);return this.remove(n),null}};const w=O;function R(){try{if(n.g)return n.g}catch(e){try{if(window)return window}catch(e){return this}}}var L=null;function I(){if(null===L){let e=R();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),L=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return L}function T(){let e=R();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function S(){let e=I(),t=T(),n=t[e];return n||(t[e]=Object.create(null),n=t[e]),n}!function(){let e=R();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var j="__INTENTIONAL_UNDEFINED__";let D={};function $(e){let t=S();if(void 0===t[e])return function(e){if("extensionLocalStorage"===e)return b.wS;return}(e);var n=t[e];return n===j?void 0:n}function x(e,t){let n=S();return"object"==typeof e?(Object.keys(e).forEach((function(t){n[t]=e[t]})),function(){Object.keys(e).forEach((function(t){k(e)}))}):(n[e]=void 0===t?j:t,function(){k(e)})}function k(e){let t=S();delete t[e],0==Object.keys(t).length&&delete T()[I]}function A(e){let t=S();var n=Object.keys(e),r={};function o(){n.forEach((function(e){t[e]=r[e]}))}return function(s){n.forEach((function(n){r[n]=t[n],t[n]=e[n]}));let i=s();return i&&"function"==typeof i.then?i.then(o).catch(o):o(),i}}!function(){function e(e,t){Object.defineProperty(D,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",$),e("__GetDependency__",$),e("__Rewire__",x),e("__set__",x),e("__reset__",k),e("__ResetDependency__",k),e("__with__",A)}();function G(e,t){Object.defineProperty(O,e,{value:t,enumerable:!1,configurable:!0})}Object.isExtensible(O)&&(G("__get__",$),G("__GetDependency__",$),G("__Rewire__",x),G("__set__",x),G("__reset__",k),G("__ResetDependency__",k),G("__with__",A),G("__RewireAPI__",D));const P=async()=>{await X("db").getSetting("display_tutorial")&&chrome.runtime.sendMessage({action:"startTutorial",data:{}})},C=document.querySelector(".js-extensionPage .js-installFeedback");let M={signIn:!1,congrats:!1};function N(){try{if(n.g)return n.g}catch(e){try{if(window)return window}catch(e){return this}}}X("modalCongrats")&&!X("modalCongrats").classList.contains("hidden")&&X("modalCongrats").classList.add("hidden"),X("Observer").observe(".js-extensionPage #modal-rewards-sign",(function(e){let t=e[0].classList.contains("in");!t&&X("modalIsOpen").signIn&&X("sendMessageTutorial")(),X("modalIsOpen").signIn=t})),X("Observer").observe(".js-extensionPage .js-step-to-complete",(function(e){e[0].classList.contains("is-completed")&&!X("modalIsOpen").congrats&&(X("sendMessageTutorial")(),X("modalIsOpen").congrats=!0)}));var B=null;function W(){if(null===B){let e=N();e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__||(e.__$$GLOBAL_REWIRE_NEXT_MODULE_ID__=0),B=__$$GLOBAL_REWIRE_NEXT_MODULE_ID__++}return B}function U(){let e=N();return e.__$$GLOBAL_REWIRE_REGISTRY__||(e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)),e.__$$GLOBAL_REWIRE_REGISTRY__}function q(){let e=W(),t=U(),n=t[e];return n||(t[e]=Object.create(null),n=t[e]),n}!function(){let e=N();e.__rewire_reset_all__||(e.__rewire_reset_all__=function(){e.__$$GLOBAL_REWIRE_REGISTRY__=Object.create(null)})}();var F="__INTENTIONAL_UNDEFINED__";let Y={};function X(e){let t=q();if(void 0===t[e])return function(e){switch(e){case"db":return w;case"modalCongrats":return C;case"Observer":return r;case"modalIsOpen":return M;case"sendMessageTutorial":return P}return}(e);var n=t[e];return n===F?void 0:n}function K(e,t){let n=q();return"object"==typeof e?(Object.keys(e).forEach((function(t){n[t]=e[t]})),function(){Object.keys(e).forEach((function(t){V(e)}))}):(n[e]=void 0===t?F:t,function(){V(e)})}function V(e){let t=q();delete t[e],0==Object.keys(t).length&&delete U()[W]}function H(e){let t=q();var n=Object.keys(e),r={};function o(){n.forEach((function(e){t[e]=r[e]}))}return function(s){n.forEach((function(n){r[n]=t[n],t[n]=e[n]}));let i=s();return i&&"function"==typeof i.then?i.then(o).catch(o):o(),i}}!function(){function e(e,t){Object.defineProperty(Y,e,{value:t,enumerable:!1,configurable:!0})}e("__get__",X),e("__GetDependency__",X),e("__Rewire__",K),e("__set__",K),e("__reset__",V),e("__ResetDependency__",V),e("__with__",H)}()})()})();