(()=>{"use strict";const e=(e,t)=>({type:e,data:t}),t={elementSelectedBg:"#A0F060",elementSelectionRangeBg:"#A06060",typingOverlayBg:"#FFFFFF",typingOverlayFg:"#000000",wrongText:"#FF7060",composingText:"#46F6FF",useCpm:!1},s=e=>new Promise((s=>{chrome.storage.local.get(e,(o=>{s(e in o?o[e]:t[e])}))})),o=t=>{chrome.action.disable(t),chrome.tabs.sendMessage(t,e("PING"),(e=>{chrome.runtime.lastError||"PONG"!==e||(console.log("PONG from",t),chrome.action.enable(t))}))},a=async()=>{chrome.contextMenus.removeAll();const e=await s("useCpm"),t=await new Promise((e=>{chrome.storage.local.get(["selectionMessageClosed","typingMessageClosed","finishedMessageClosed","statsClosed"],(t=>{e({selectionMessageClosed:t.selectionMessageClosed||!1,typingMessageClosed:t.typingMessageClosed||!1,finishedMessageClosed:t.finishedMessageClosed||!1,statsClosed:t.statsClosed||!1})}))}));t.statsClosed||chrome.contextMenus.create({id:"toggleSpeedUnit",title:e?"Switch to WPM":"Switch to CPM",contexts:["action"]}),t.statsClosed&&chrome.contextMenus.create({id:"enableStatsMessage",title:"Show Typing Speed/Accuracy",contexts:["action"]}),t.selectionMessageClosed&&chrome.contextMenus.create({id:"enableSelectionMessage",title:"Show Shortcuts for Selection Stage",contexts:["action"]}),t.typingMessageClosed&&chrome.contextMenus.create({id:"enableTypingMessage",title:"Show Shortcuts for Typing Stage",contexts:["action"]}),t.finishedMessageClosed&&chrome.contextMenus.create({id:"enableFinishedMessage",title:"Show Shortcuts for Finished Stage",contexts:["action"]})};chrome.contextMenus.onClicked.addListener((async(e,t)=>{switch(e.menuItemId){case"toggleSpeedUnit":const e=!await s("useCpm");chrome.storage.local.set({useCpm:e}),chrome.contextMenus.update("toggleSpeedUnit",{title:e?"Switch to WPM":"Switch to CPM"});break;case"enableSelectionMessage":chrome.storage.local.set({selectionMessageClosed:!1});break;case"enableTypingMessage":chrome.storage.local.set({typingMessageClosed:!1});break;case"enableFinishedMessage":chrome.storage.local.set({finishedMessageClosed:!1});break;case"enableStatsMessage":chrome.storage.local.set({statsClosed:!1})}})),chrome.storage.onChanged.addListener(((e,t)=>{if("local"===t){if(e.useCpm){const t=e.useCpm.newValue;chrome.contextMenus.update("toggleSpeedUnit",{title:t?"Switch to WPM":"Switch to CPM"})}["selectionMessageClosed","typingMessageClosed","finishedMessageClosed","statsClosed"].some((t=>t in e))&&a()}})),chrome.tabs.onActivated.addListener((e=>o(e.tabId))),chrome.tabs.onUpdated.addListener((e=>o(e))),chrome.runtime.onInstalled.addListener((e=>{a(),chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.runtime.lastError||e.length<1||null==e[0].id||o(e[0].id)}))})),chrome.runtime.onStartup.addListener((()=>{a()})),chrome.runtime.onMessage.addListener(((e,t)=>{console.log("ready from",t),null!=t.tab?.id&&"READY"==e.type&&chrome.action.enable(t.tab.id)})),chrome.action.onClicked.addListener((t=>{null!=t.id&&(chrome.runtime.lastError?chrome.action.disable(t.id):(o(t.id),chrome.tabs.sendMessage(t.id,e("START_ELEMENT_PICKER"),(()=>{chrome.runtime.lastError}))))}))})();